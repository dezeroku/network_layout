set -e

if [ "{{ .Env.ENABLE_LETSENCRYPT_CERTS_TEMPLATE }}" = "true" ]; then
    uci set system.@system[0].hostname='{{ .Env.HOSTNAME_TEMPLATE }}.{{ .Env.LETSENCRYPT_HOSTNAME_TEMPLATE }}'
    uci commit system
else
    uci set system.@system[0].hostname='{{ .Env.HOSTNAME_TEMPLATE }}'
    uci commit system
fi

uci batch << EOI
set system.@system[0].zonename='{{ .Env.ZONENAME_TEMPLATE }}'
set system.@system[0].timezone='{{ .Env.TIMEZONE_TEMPLATE }}'
set system.@system[0].log_proto='udp'
set system.@system[0].conloglevel='8'
set system.@system[0].cronloglevel='5'
commit system

set uhttpd.main.redirect_https='on'
commit uhttpd

set irqbalance.irqbalance.enabled='1'
commit irqbalance
EOI

/etc/init.d/irqbalance start
